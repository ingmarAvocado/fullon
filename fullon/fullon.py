#!/usr/bin/python3
from libs.settings_config import fullon_settings_loader
from libs import settings
from libs import simul
from run.simul_manager import SimulManager
from libs.database import start as start_database, stop as stop_database
from libs.database_ohlcv import start as start_ohlcv, stop as stop_ohlcv
from libs.simul_launcher import simulator
from libs.bot import Bot
settings.NOISE = True
settings.LOG_LEVEL = 'ERROR'
start_database()
start_ohlcv()
simulator.start()



params2 = {
          "stop_loss": "None",
          'take_profit': "None",
          'trailing_stop': "90",
          "timeout": "None",
          'rsi': "14",  #
          'rsi_entry': "65",
          'rsi_exit': "60",
          'rsi_weight': "3",
          'cmf': "18",
          'cmf_entry': '11',
          'cmf_exit': '5',
          'cmf_weight': '1',
          'vwap_entry': "0.2",
          'vwap_exit': "0.4",
          'vwap_weight': "4",
          'obv': "18",
          'obv_entry': "1.4",
          'obv_exit': "0.8",
          'obv_weight': "3",
          'macd_entry': "3",
          'macd_exit': "0",
          'macd_weight': "2",
          'stoch_entry': "55",
          'stoch_exit': "50",
          'stoch_weight': "4",
          'ema': '21',
          'entry': "16",
          'exit': "41",
          "leverage": "2",
          "size_pct": "45",
          "size": "500"}

#params = {"sma1": "30", "sma2": "13", "zshort": "-1", "zlong": "1", "zexitlow": "-0.75", "zexithigh": "0.75", "stop_loss": "4.1"}
BOT = {"bot_id": 35,
       "periods": 450,
       "warm_up": 50,
       "xls": False,
       "verbose": False,
       "visual": False}
filename = None
feeds = {}
#filename = "rsi2long2.csv"
#feeds = {2: {'compression': 30}, 3: {'compression': 30}}
#feeds = {1: {'compression': 480}}
'''
abot = Bot(BOT['bot_id'], BOT['periods'])
params3 = {}
for p, key in params2.items():
    try:
       params3[p] = float(key)
    except ValueError:
       if key == "None":
           params3[p] = None
       else:
           raise
abot.run_simul_loop(feeds=feeds, warm_up=BOT['warm_up'], visual=False, test_params=params3, event=True)
#abot.run_simul_loop(feeds=feeds, warm_up=BOT['warm_up'], visual=False, test_params={}, event=True)
#params2 = {}
#params2 = {"size_pct": "10"}
'''
simul = SimulManager()
simul.bot_simul(bot=BOT,
                event_based=True,
                feeds=feeds,
                params=params2,
                filename=filename,
                montecarlo=1,
                sharpe_filter=-10.00)

stop_database()
stop_ohlcv()
simulator.stop()


'''



==========================

Strategy: xgb_forest - Symbol: BTC/USD - Period: Minutes - Compressions: (1, 240)

Multiple sim results: - Strategy: xgb_forest - Symbol: BTC/USD - Period: Minutes - Compressions: (1, 240) - From: 2022-12-14 00:02:00 to 2023-12-29 00:00:00
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
|   | rsi  | rsi_entry | cmf  | cmf_entry | vwap_entry | obv  | obv_entry | macd_entry | stoch_entry | ema  | prediction_steps | threshold | TP  |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
| 0 | 14.0 |   60.0    | 18.0 |   11.0    |    0.6     | 18.0 |    1.4    |    3.0     |    55.0     | 50.0 |       1.0        |   0.35    | 8.0 | 10.0 | 300.0 |  11070.74   |    10984.9    |  12755.25  |  9439.61   |   614.04   |    0.06    |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+




Multiple sim results: - Strategy: xgb_forest - Symbol: BTC/USD - Period: Minutes - Compressions: (1, 240) - From: 2023-09-20 00:02:00 to 2023-12-29 00:00:00
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
|   | rsi  | rsi_entry | cmf  | cmf_entry | vwap_entry | obv  | obv_entry | macd_entry | stoch_entry | ema  | prediction_steps | threshold | TP  |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
| 0 | 14.0 |   60.0    | 18.0 |   11.0    |    0.6     | 18.0 |    1.4    |    3.0     |    55.0     | 50.0 |       1.0        |   0.35    | 8.0 | 10.0 | 300.0 |   5426.78   |    5236.65    |  6753.58   |  4793.38   |   390.55   |    0.07    |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
---



==========================





Multiple sim results: - Strategy: xgb_forest - Symbol: BTC/USD - Period: Minutes - Compressions: (1, 480) - From: 2022-12-14 00:02:00 to 2023-12-29 00:00:00
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
|   | rsi  | rsi_entry | cmf  | cmf_entry | vwap_entry | obv  | obv_entry | macd_entry | stoch_entry | ema  | prediction_steps | threshold | TP  |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
| 0 | 14.0 |   60.0    | 18.0 |   11.0    |    0.6     | 18.0 |    1.4    |    3.0     |    55.0     | 50.0 |       1.0        |   0.35    | 8.0 | 10.0 | 300.0 |  10749.33   |   10769.29    |  15030.45  |  6501.75   |  1757.14   |    0.16    |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
--------------------------------------------------------------------------------


Multiple sim results: - Strategy: xgb_forest - Symbol: BTC/USD - Period: Minutes - Compressions: (1, 480) - From: 2023-09-20 00:02:00 to 2023-12-29 00:00:00
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
|   | rsi  | rsi_entry | cmf  | cmf_entry | vwap_entry | obv  | obv_entry | macd_entry | stoch_entry | ema  | prediction_steps | threshold | TP  |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+
| 0 | 14.0 |   60.0    | 18.0 |   11.0    |    0.6     | 18.0 |    1.4    |    3.0     |    55.0     | 50.0 |       1.0        |   0.35    | 8.0 | 10.0 | 300.0 |   5562.1    |    5546.38    |  6182.92   |  5010.01   |   206.77   |    0.04    |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+-----+------+-------+-------------+---------------+------------+------------+------------+------------+




==========================


--------------------------------------------------------------------------------
Multiple sim results: - Strategy: xgb_forest_mom_long - Symbol: BTC/USD - Periods: (mins, days) - Compressions: (1, 1) - From: 2022-11-22 00:01:00 to 2024-01-01 00:00:00
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
|   | rsi  | rsi_entry | cmf  | cmf_entry | vwap_entry | obv  | obv_entry | macd_entry | stoch_entry | ema  | prediction_steps | threshold |  TP  |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
| 0 | 14.0 |   65.0    | 18.0 |   11.0    |    0.6     | 18.0 |    1.4    |    3.0     |    55.0     | 50.0 |       1.0        |   0.35    | 20.0 | 11.0 | 40.0  |   19786.3   |   20146.46    |  20743.07  |  17647.73  |   790.38   |    0.04    |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
--------------------------------------------------------------------------------

less days
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
|   | rsi  | rsi_entry | cmf  | cmf_entry | vwap_entry | obv  | obv_entry | macd_entry | stoch_entry | ema  | prediction_steps | threshold |  TP  |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
| 0 | 14.0 |   65.0    | 18.0 |   11.0    |    0.6     | 18.0 |    1.4    |    3.0     |    55.0     | 40.0 |       1.0        |   0.35    | 20.0 | 11.0 | 300.0 |   4750.69   |    4717.79    |  4905.74   |  4650.74   |   73.42    |    0.02    |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+------+------+-------+-------------+---------------+------------+------------+------------+------------+



--------------------------------------------------------------------------------
Strategy: xgb_forest_mom_long - Symbol: ETH/USD - Periods: (mins, days) - Compressions: (1, 1) - From: 2022-11-11 00:01:00 to 2024-01-02 00:00:00
--------------------------------------------------------------------------------
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+------+-----+---------+------------+---------+----------+--------+-----------+----------+-----------+-----------+-----------+-------------+
|   | rsi  | rsi_entry | cmf  | cmf_entry | vwap_entry | obv  | obv_entry | macd_entry | stoch_entry | ema  | prediction_steps | threshold |  TP  | TS  | TTrades | Win rate % |  Fees   |  Profit  |  ROI   | AvgReturn | Duration | MedReturn | NegStdDev | PosStdDev | SharpeRatio |
+---+------+-----------+------+-----------+------------+------+-----------+------------+-------------+------+------------------+-----------+------+-----+---------+------------+---------+----------+--------+-----------+----------+-----------+-----------+-----------+-------------+
| 0 | 14.0 |   60.0    | 18.0 |   11.0    |    0.6     | 18.0 |    1.4    |    3.0     |    50.0     | 30.0 |       1.0        |    0.3    | 17.0 | 5.0 |  55.0   |   50.91    | 2464.82 | 12626.12 | 126.26 |   1.81    |  128.61  |   0.01    |   2.06    |   5.28    |    0.31     |





Multiple sim results: - Strategy: heuristic_longs - Symbol: BTC/USD - Periods: (mins, mins) - Compressions: (1, 240) - From: 2022-10-23 20:01:00 to 2024-01-03 00:00:00
+----+------+-----------+----------+------------+------+-----------+----------+------------+------------+-----------+-------------+---------+---------------+--------------+----------------+------+-----------+----------+------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+--------+------+-------+-------------+---------------+------------+------------+------------+------------+
|    | rsi  | rsi_entry | rsi_exit | rsi_weight | cmf  | cmf_entry | cmf_exit | cmf_weight | vwap_entry | vwap_exit | vwap_weight | ad_line | ad_line_entry | ad_line_exit | ad_line_weight | obv  | obv_entry | obv_exit | obv_weight | macd_entry | macd_exit | macd_weight | stoch_entry | stoch_exit | stoch_weight | entry | exit |  ema   |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+----+------+-----------+----------+------------+------+-----------+----------+------------+------------+-----------+-------------+---------+---------------+--------------+----------------+------+-----------+----------+------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+--------+------+-------+-------------+---------------+------------+------------+------------+------------+
| 8  | 14.0 |   70.0    |   61.0   |    4.0     | 18.0 |   11.0    |   5.0    |    7.0     |    0.6     |    0.4    |    10.0     |  17.0   |      9.0      |     5.0      |      9.0       | 18.0 |    1.4    |   0.8    |    3.0     |    3.0     |    0.0    |    12.0     |    50.0     |    46.0    |     14.0     | 55.0  | 86.0 |  30.0  | 90.0 |  6.0  |  12320.67   |   12472.56    |  13117.04  |  11511.89  |   603.28   |    0.05    |




--------------------------------------------------------------------------------


Multiple sim results: - Strategy: heuristic_longs - Symbol: BTC/USD - Periods: (mins, days) - Compressions: (1, 1) - From: 2022-11-30 00:01:00 to 2024-01-03 00:00:00
+---+------+------+-----------+----------+------------+------+-----------+----------+------------+------------+-----------+-------------+---------+---------------+--------------+----------------+------+-----------+----------+------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
|   | ema  | rsi  | rsi_entry | rsi_exit | rsi_weight | cmf  | cmf_entry | cmf_exit | cmf_weight | vwap_entry | vwap_exit | vwap_weight | ad_line | ad_line_entry | ad_line_exit | ad_line_weight | obv  | obv_entry | obv_exit | obv_weight | macd_entry | macd_exit | macd_weight | stoch_entry | stoch_exit | stoch_weight | entry | exit |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+---+------+------+-----------+----------+------------+------+-----------+----------+------------+------------+-----------+-------------+---------+---------------+--------------+----------------+------+-----------+----------+------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
| 0 | 21.0 | 14.0 |   65.0    |   60.0   |    3.0     | 18.0 |   11.0    |   5.0    |    0.0     |    0.6     |    0.4    |     4.0     |  17.0   |      9.0      |     5.0      |      0.0       | 18.0 |    1.4    |   0.8    |    3.0     |    3.0     |    0.0    |     0.0     |    55.0     |    50.0    |     4.0      | 18.0  | 43.0 | 90.0 | 12.0  |  63684.29   |    63796.0    |  71528.88  |  57735.46  |  3680.88   |    0.06    |
| 1 | 21.0 | 14.0 |   65.0    |   60.0   |    3.0     | 18.0 |   11.0    |   5.0    |    0.0     |    0.6     |    0.4    |     4.0     |  17.0   |      9.0      |     5.0      |      0.0       | 18.0 |    1.4    |   0.8    |    3.0     |    3.0     |    0.0    |     0.0     |    55.0     |    50.0    |     4.0      | 18.0  | 50.0 | 90.0 | 12.0  |  61582.93   |   61584.58    |  68193.47  |  52822.43  |   4366.9   |    0.07    |



--------------------------------------------------------------------------------
Multiple sim results: - Strategy: heuristic_longs - Symbol: BTC/USD - Periods: (mins, days) - Compressions: (1, 1) - From: 2022-11-30 00:01:00 to 2024-01-03 00:00:00
+-----+------+------+-----------+----------+------------+------+-----------+----------+------------+------------+-----------+-------------+---------+---------------+--------------+----------------+------+-----------+----------+------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
|     | ema  | rsi  | rsi_entry | rsi_exit | rsi_weight | cmf  | cmf_entry | cmf_exit | cmf_weight | vwap_entry | vwap_exit | vwap_weight | ad_line | ad_line_entry | ad_line_exit | ad_line_weight | obv  | obv_entry | obv_exit | obv_weight | macd_entry | macd_exit | macd_weight | stoch_entry | stoch_exit | stoch_weight | entry | exit |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+-----+------+------+-----------+----------+------------+------+-----------+----------+------------+------------+-----------+-------------+---------+---------------+--------------+----------------+------+-----------+----------+------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
| 54  | 21.0 | 14.0 |   65.0    |   60.0   |    3.0     | 18.0 |   11.0    |   5.0    |    0.0     |    0.6     |    0.4    |     4.0     |  17.0   |      9.0      |     5.0      |      0.0       | 18.0 |    1.4    |   0.8    |    3.0     |    3.0     |    0.0    |     2.0     |    55.0     |    50.0    |     4.0      | 12.0  | 43.0 | 90.0 |  3.0  |  61912.94   |   58591.11    |  69587.69  |  57560.03  |  6666.49   |    0.11  


Multiple sim results: - Strategy: heuristic_shorts - Symbol: BTC/USD - Periods: (mins, days) - Compressions: (1, 1) - From: 2022-11-16 00:01:00 to 2024-01-01 00:01:00
+---+------+-----------+----------+------------+------------+-----------+-------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
|   | rsi  | rsi_entry | rsi_exit | rsi_weight | macd_entry | macd_exit | macd_weight | vwap_entry | vwap_exit | vwap_weight | stoch_entry | stoch_exit | stoch_weight | entry | exit | ema  |  TP  |  TS  | Count | Profit_mean | Profit_median | Profit_max | Profit_min | Profit_std | Risk_Score |
+---+------+-----------+----------+------------+------------+-----------+-------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+------+------+------+-------+-------------+---------------+------------+------------+------------+------------+
| 0 | 14.0 |   45.0    |   45.0   |    4.0     |    -1.0    |   -2.0    |     1.0     |    -2.0    |   -1.0    |     1.0     |    40.0     |    20.0    |     0.0      | 18.0  | 56.0 | 21.0 | 30.0 | 30.0 | 40.0  |   6040.43   |    6056.58    |  6305.42   |  5630.48   |   151.22   |    0.03    |
+---+------+-----------+----------+------------+------------+-----------+-------------+------------+-----------+-------------+-------------+------------+--------------+-------+------+------+------+------+-------+-------------+---------------+------------+------------+------------+------------+


params2 = {
          "stop_loss": "None",
          'take_profit': "6:18",
          'trailing_stop': "4:10",  # 12
          "timeout": "None",
          'rsi': "14",  #
          'rsi_entry': "43",
          'cmf': "18",
          'cmf_entry': '-21',
          'vwap_entry': "-3.2",
          'obv': "18",
          'obv_entry': "-4",
          'macd_entry': "0",
          'stoch_entry': "45",
          "ema": "20",
          "leverage": "2",
          "size_pct": "10",
          "prediction_steps": "1",
          "threshold": "0.35",
          "size": "500"}




params2 = {
          "stop_loss": "None",
          'take_profit': "12",
          'trailing_stop': "5",  # 12
          "timeout": "None",
          'rsi': "14",  #
          'rsi_entry': "43",
          'macd_entry': "0",
          'stoch_entry': "45",
          "ema": "21",
          "leverage": "2",
          "size_pct": "24",
          "prediction_steps": "1",
          "threshold": "0.35",
          "size": "500"}



params2 = {
          "stop_loss": "None",
          'take_profit': "None",
          'trailing_stop': "90",
          "timeout": "None",
          'rsi': "14",  #
          'rsi_entry': "65",
          'rsi_exit': "60",
          'rsi_weight': "3",
          'cmf': "18",
          'cmf_entry': '11',
          'cmf_exit': '5',
          'cmf_weight': '1',
          'vwap_entry': "0.2",
          'vwap_exit': "0.4",
          'vwap_weight': "4",
          'obv': "18",
          'obv_entry': "1.4",
          'obv_exit': "0.8",
          'obv_weight': "3",
          'macd_entry': "3",
          'macd_exit': "0",
          'macd_weight': "2",
          'stoch_entry': "55",
          'stoch_exit': "50",
          'stoch_weight': "4",
          'ema': '21',
          'entry': "16",
          'exit': "41",
          "leverage": "2",
          "size_pct": "45",
          "size": "500"}


params2 = {
          "stop_loss": "None",
          'take_profit': "15",
          'trailing_stop': "10",
          "timeout": "None",
          'rsi': "14",  #
          'rsi_entry': "45",
          'rsi_exit': "45",
          'rsi_weight': "4",
          'rsi_sma': "18",
          'rsi_sma_weight': "1",
          'vwap_entry': "-2",
          'vwap_exit': "-1",
          'vwap_weight': "1",
          'macd_entry': "-1",
          'macd_exit': "-2",
          'macd_weight': "1",
          'ema': '21',
          'entry': "18",
          'exit': "56",
          "leverage": "2",
          "size_pct": "24",
          "size": "2000"}


'''